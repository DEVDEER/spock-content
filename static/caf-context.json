{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://docs.devdeer.io/content/caf/overview.html",
    "title": "AzureCafContextOptions",
    "description": "Schema for the CAF context configuration file.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "A reference to the schema definition for this context file."
        },
        "tenantId": {
            "type": "string",
            "description": "The GUID of the tenant in Azure which is holding management resources."
        },
        "subscriptionId": {
            "type": "string",
            "description": "The GUID of a subscription which should be targeted in the current context."
        },
        "managementGroupId": {
            "type": "string",
            "description": "The ID of a management group which should be targeted in the current context."
        },
        "managementSubscriptionId": {
            "type": "string",
            "description": "The GUID of the subscription which is holding management resources."
        },
        "adminEntraGroupName": {
            "type": "string",
            "description": "The name of the Entra security group which represents elevated users in PIM."
        },
        "companyShort": {
            "type": "string",
            "description": "Short name or abbreviation of the company."
        },
        "companyName": {
            "type": "string",
            "description": "Full company name."
        },
        "isRoot": {
            "type": "boolean",
            "description": "Defines if this is the root .azcontext so the searcher will not search up the tree."
        },
        "forceContext": {
            "type": "boolean",
            "description": "Defines if the context will be set in any case to the tenant and subscription provided here."
        },
        "subscriptionsToIgnore": {
            "type": "array",
            "description": "An optional array of subscription ids which should be ignored by CAF scripts.",
            "items": {
                "type": "string"
            }
        },
        "cspServicePrincipalId": {
            "type": "string",
            "description": "Optional id of the CSP service principle."
        },
        "managementGroupsToIgnore": {
            "type": "array",
            "description": "List of management group IDs to ignore.",
            "items": {
                "type": "string"
            }
        },
        "azureDevOps": {
            "type": "object",
            "description": "Configuration for Azure DevOps environment.",
            "properties": {
                "defaultOrganizationName": {
                    "type": "string",
                    "description": "Default organization name for Azure DevOps projects."
                },
                "projects": {
                    "type": "object",
                    "description": "Object containing project configurations with project names as keys.",
                    "patternProperties": {
                        "^.*$": {
                            "type": "array",
                            "description": "Array of service connection configurations for a project.",
                            "items": {
                                "type": "object",
                                "description": "A single service-connection configuration.",
                                "properties": {
                                    "subscriptionId": {
                                        "type": "string",
                                        "description": "Subscription ID in Azure related to this service connection."
                                    },
                                    "managementGroupId": {
                                        "type": "string",
                                        "description": "Management group ID where this subscription resides."
                                    },
                                    "serviceConnectionScope": {
                                        "type": "string",
                                        "description": "Scope of the service connection (e.g., 'subscription' or 'managementGroup').",
                                        "enum": [
                                            "subscription",
                                            "managementGroup"
                                        ]
                                    },
                                    "organizationName": {
                                        "type": "string",
                                        "description": "Name of the Azure DevOps organization for this connection, overrides defaultOrganizationName."
                                    },
                                    "projectName": {
                                        "type": "string",
                                        "description": "Optional name/key for the project entry."
                                    }
                                },
                                "required": [
                                    "subscriptionId",
                                    "managementGroupId",
                                    "serviceConnectionScope"
                                ],
                                "additionalProperties": false
                            }
                        }
                    },
                    "additionalProperties": false
                }
            },
            "required": [
                "defaultOrganizationName",
                "projects"
            ],
            "additionalProperties": false
        },
        "azureBudgets": {
            "type": "object",
            "description": "Configuration for Azure budget settings. Supports automatic date calculation and flexible global/subscription-level overrides.",
            "properties": {
                "defaultActionGroupResourceId": {
                    "type": "string",
                    "description": "Resource ID for the default action group to notify when budget thresholds are exceeded. Used as fallback when subscription-level actionGroupResourceId is not specified."
                },
                "startDate": {
                    "type": "string",
                    "format": "date",
                    "description": "Optional global start date for budgets in YYYY-MM-DD format. If not specified, defaults to first day of current month. Can be overridden at subscription level."
                },
                "endDate": {
                    "type": "string",
                    "format": "date",
                    "description": "Optional global end date for budgets in YYYY-MM-DD format. If not specified, defaults to first day of current month plus one year. Can be overridden at subscription level."
                },
                "currency": {
                    "type": "string",
                    "description": "Optional global currency code for budgets (e.g., 'USD', 'EUR', 'GBP'). Can be overridden at subscription level.",
                    "enum": [
                        "USD",
                        "EUR", 
                        "GBP",
                        "CAD",
                        "AUD",
                        "JPY",
                        "CHF"
                    ]
                },
                "thresholdRules": {
                    "type": "array",
                    "description": "Optional global array of threshold percentages for budget alerts (e.g., [80, 90, 100]). Can be overridden at subscription level.",
                    "items": {
                        "type": "number",
                        "minimum": 1,
                        "maximum": 1000,
                        "description": "Threshold percentage value (1-1000)"
                    }
                },
                "thresholdType": {
                    "type": "string", 
                    "description": "Optional global type of threshold calculation. 'Actual' uses current spending, 'Forecasted' uses predicted spending. Can be overridden at subscription level.",
                    "enum": [
                        "Forecasted",
                        "Actual"
                    ]
                },
                "subscriptions": {
                    "type": "object",
                    "description": "Budget configurations for various subscriptions. Each subscription can override global settings.",
                    "patternProperties": {
                        "^.*$": {
                            "type": "array",
                            "description": "Array of budget configurations for the subscription. Multiple budgets can be defined with different time grains.",
                            "items": {
                                "type": "object",
                                "description": "Individual budget configuration. Required fields: timeGrain, amount. Optional fields override global settings.",
                                "properties": {
                                    "timeGrain": {
                                        "type": "string",
                                        "description": "Time grain for the budget period.",
                                        "enum": [
                                            "Monthly",
                                            "Quarterly", 
                                            "Annually"
                                        ]
                                    },
                                    "amount": {
                                        "type": "number",
                                        "minimum": 0.01,
                                        "description": "Budget amount in the specified currency."
                                    },
                                    "startDate": {
                                        "type": "string",
                                        "format": "date",
                                        "description": "Optional start date override for this budget in YYYY-MM-DD format. Overrides global startDate and auto-calculation."
                                    },
                                    "endDate": {
                                        "type": "string",
                                        "format": "date", 
                                        "description": "Optional end date override for this budget in YYYY-MM-DD format. Overrides global endDate and auto-calculation."
                                    },
                                    "currency": {
                                        "type": "string",
                                        "description": "Optional currency override for this budget. Overrides global currency setting.",
                                        "enum": [
                                            "USD",
                                            "EUR",
                                            "GBP", 
                                            "CAD",
                                            "AUD",
                                            "JPY",
                                            "CHF"
                                        ]
                                    },
                                    "thresholdRules": {
                                        "type": "array",
                                        "description": "Optional threshold percentages override for this budget. Overrides global thresholdRules.",
                                        "items": {
                                            "type": "number",
                                            "minimum": 1,
                                            "maximum": 1000,
                                            "description": "Threshold percentage value (1-1000)"
                                        }
                                    },
                                    "thresholdType": {
                                        "type": "string",
                                        "description": "Optional threshold calculation type override for this budget. Overrides global thresholdType.",
                                        "enum": [
                                            "Forecasted",
                                            "Actual"
                                        ]
                                    },
                                    "actionGroupResourceId": {
                                        "type": "string",
                                        "description": "Optional action group resource ID override for this budget. Overrides defaultActionGroupResourceId."
                                    }
                                },
                                "required": [
                                    "timeGrain",
                                    "amount"
                                ],
                                "additionalProperties": false
                            }
                        }
                    },
                    "additionalProperties": false
                }
            },
            "required": [
                "defaultActionGroupResourceId",
                "subscriptions"
            ],
            "additionalProperties": false
        }
    },
    "required": [
        "tenantId",
        "managementSubscriptionId",
        "adminEntraGroupName", 
        "companyShort",
        "companyName",
        "isRoot",
        "forceContext"
    ],
    "additionalProperties": false
}
